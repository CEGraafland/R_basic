c(2,NA))
grid::gpar(mar = c(0.0, 0.0, 0.0, 0.0), mgp = c(0, 0, 0), oma = c(0, 0, 0, 0))
grid.arrange(grobs = totallist[c(1,2)], layout_matrix = lay, gp =  gpar(mar = c(0.0, 0.0, 0.0, 0.0), mgp = c(0, 0, 0), oma = c(0, 0, 0, 0)))
lay = c(1,2)
grid::gpar(mar = c(0.0, 0.0, 0.0, 0.0), mgp = c(0, 0, 0), oma = c(0, 0, 0, 0))
grid.arrange(grobs = totallist[c(1,2)], layout_matrix = lay, gp =  gpar(mar = c(0.0, 0.0, 0.0, 0.0), mgp = c(0, 0, 0), oma = c(0, 0, 0, 0)))
lay = rbind(c(1),
c(2))
grid::gpar(mar = c(0.0, 0.0, 0.0, 0.0), mgp = c(0, 0, 0), oma = c(0, 0, 0, 0))
grid.arrange(grobs = totallist[c(1,2)], layout_matrix = lay, gp =  gpar(mar = c(0.0, 0.0, 0.0, 0.0), mgp = c(0, 0, 0), oma = c(0, 0, 0, 0)))
for( i in 1:length(variablelisttabu)){
plotstabu[[i]] <- spatialPlot(tabuclims[[i]],backdrop.theme = "coastline", main = list(paste0("Tabu: |E| = ",narcs(tabu_1_eBIC_g0.25$networks$tabu_10d_g0.25),"\n",attr(tabuclims[[i]]$Data,"climatology:fun")),cex = 0.7), colorkey = list(width = 0.6, lables = list(cex = 0.5)),at = seq(0.05,1,0.05),lonCenter = 180, region = TRUE, col.regions= cb)
}
for( i in 1:length(variablelistmmhc)){
plotsh2pc[[i]] <- spatialPlot(h2pcclims[[i]],backdrop.theme = "coastline", main = list(paste0("H2PC: |E| = ",narcs(h2pc_2_eBIC_g0.1$networks$h2pc_10d_g0.1),"\n",attr(h2pcclims[[i]]$Data,"climatology:fun")),cex = 0.7),colorkey = list(width = 0.6, lables = list(cex = 0.5)),at = seq(0.05,1,0.05), lonCenter = 180, region = TRUE, col.regions= cb)
}
totallist <- c(plotsh2pc,plotstabu)
totallist[[1]]
plotname <- paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/plots/MarcoNewPlots/propH2pcTabu.pdf")
pdf(plotname)
lay = rbind(c(1,NA),
c(2,NA))
grid::gpar(mar = c(0.0, 0.0, 0.0, 0.0), mgp = c(0, 0, 0), oma = c(0, 0, 0, 0))
grid.arrange(grobs = totallist[c(1,2)], layout_matrix = lay, gp =  gpar(mar = c(0.0, 0.0, 0.0, 0.0), mgp = c(0, 0, 0), oma = c(0, 0, 0, 0)))
dev.off()
#######################################################################################
# long distance gamma plot extendent version h2pc
#######################################################################################
plotname <- paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/plots/MarcoNewPlots/comparegraphsdistancesh2pc.pdf")
pdf(plotname, width = 14, height = 8)
op <- par(no.readonly = TRUE)
lay <- rbind(c(1,0,0),
c(2,3,0),
c(4,5,6))
graphics::layout(as.matrix(lay))
par(mar = c(0.0, 0, 1, 0.0))
par(mgp = c(0, 0, 0))
par(oma = c(0, 0, 0, 0))
# best of pcstable
plot_long_distances(pcstable2_withnet_1$networks$pcstable_10d_g0.1, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[1]],title = FALSE)
title(mar = c(0,0,0,0), main = paste0("|E| = ",narcs(pc_1_eBIC_g5)))
# # pcstablbest and best of mmhc
# plot_long_distances(mmhc_1_eBIC_g5$networks$mmhc_10d_g5, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,255,0,alpha = 100, maxColorValue = 255) ,perm = permutations[[1]], title = FALSE)
# title(mar = c(0,0,0,0), main = paste0("|E| = ",narcs(mmhc_1_eBIC_g5$networks$mmhc_10d_g5)))
# plot_long_distances(mmhc_2$networks[[2]], data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,255,0,alpha = 100, maxColorValue = 255), perm = permutations[[2]],title = FALSE)
# title(mar = c(0,0,0,0), main = paste0("|E| = ",narcs(mmhc_2$networks[[2]])))
# pcstablbest and best of h2pc
plot_long_distances(h2pc_1_eBIC_g5$networks$h2pc_10d_g5, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,100,0, alpha = 100, maxColorValue = 255) ,perm = permutations[[1]], title = FALSE)
title(mar = c(0,0,0,0), main = paste0("|E| = ",narcs(h2pc_1_eBIC_g5$networks$h2pc_10d_g5)))
plot_long_distances(h2pc_2_eBIC_g0.1$networks$h2pc_10d_g0.1, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,100,0, alpha = 100, maxColorValue = 255), perm = permutations[[2]],title = FALSE)
title(mar = c(0,0,0,0), main = paste0("|E| = ",narcs(h2pc_2_eBIC_g0.1$networks$h2pc_10d_g0.1)))
# pcstablebest, mmhcbest, hcbien.
plot_long_distances(tabu_1_eBIC_g5$networks$tabu_10d_g5, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(200,100,100, alpha = 100, maxColorValue = 255), perm = permutations[[1]],title = FALSE, remove = TRUE)
title(mar = c(0,0,0,0), main = paste0("|E| = ",narcs(tabu_1_eBIC_g5$networks$tabu_10d_g5)))
plot_long_distances(tabu_2_eBIC_g0.75$networks$tabu_10d_g0.75, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(200,100,100, alpha = 50,maxColorValue = 255), perm = permutations[[2]], title = FALSE, remove = TRUE)
title(mar = c(0,0,0,0), main = paste0("|E| = ",narcs(tabu_2_eBIC_g0.75$networks$tabu_10d_g0.75)))
plot_long_distances(tabu_1_eBIC_g0.25$networks$tabu_10d_g0.25, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(200,100,100, alpha = 50,maxColorValue = 255),perm = permutations[[1]], title = FALSE, remove = TRUE)
title(mar = c(0,0,0,0), main = paste0("|E| = ",narcs(tabu_1_eBIC_g0.25$networks$tabu_10d_g0.25)))
dev.off()
plot_undirected_distances(pcstable2_withnet_3$networks$pcstable_10d_g0.1,data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[3]],title = TRUE)
plot_undirected_distances(pcstable2_withnet_2$networks$pcstable_10d_g0.1,data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[3]],title = TRUE)
plot_undirected_distances(pcstable2_withnet_2$networks$pcstable_10d_g0.1,data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[2]],title = TRUE)
plot_undirected_distances(pcstable2_withnet_1$networks$pcstable_10d_g0.1,data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[1]],title = TRUE)
# plot_long_distances(gs_withnet_1$networks$gs_10d_g0.1, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 20000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[1]],title = TRUE)
plot_undirected_distances(gs_withnet_2$networks$gs_10d_g0.1,data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[2]],title = TRUE)
# plot_long_distances(gs_withnet_1$networks$gs_10d_g0.1, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 20000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[1]],title = TRUE)
plot_undirected_distances(gs_withnet_3$networks$gs_10d_g0.1,data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[3]],title = TRUE)
# plot_long_distances(gs_withnet_1$networks$gs_10d_g0.1, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 20000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[1]],title = TRUE)
plot_undirected_distances(gs_withnet_4$networks$gs_10d_g0.1,data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[4]],title = TRUE)
# plot_long_distances(gs_withnet_1$networks$gs_10d_g0.1, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 20000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[1]],title = TRUE)
plot_undirected_distances(gs_withnet_5$networks$gs_10d_g0.1,data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[5]],title = TRUE)
########################################################################
# Use plot undirected distances.
##########################################################################
plotname <- "/oceano/gmeteo/WORK/lisette/Trabajo/PGMext/paper/figures/gsundirected.pdf"
pdf(plotname)
# plot_long_distances(gs_withnet_1$networks$gs_10d_g0.1, data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 20000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[1]],title = TRUE)
plot_undirected_distances(gs_withnet_5$networks$gs_10d_g0.1,data.dag = TimeCoordsAnom_from_Grid_std(tas_ncep_10d),minimdist = 5000, smallcol = rgb(0,0,255,alpha = 100, maxColorValue = 255), perm = permutations[[5]],title = TRUE)
dev.off()
ejesmmhcBIC <- lapply(list(mmhc_1_eBIC,mmhc_2_eBIC,mmhc_3_eBIC,mmhc_4_eBIC,mmhc_5_eBIC), ejes_gamma_tests,1)
ejesh2pcBIC <- lapply(list(h2pc_1_eBIC,h2pc_2_eBIC,h2pc_3_eBIC,h2pc_4_eBIC,h2pc_1_eBIC), ejes_gamma_tests,1)
ejesh2pcBIC[[1]][[2]]
ejesh2pcBIC[[2]][[2]]
ejesh2pcBIC[[3]][[2]]
h2pc_med_eBIC
x <- seq(0,9000,100)
y <- seq(100,9100,100)
#####################################################################################
# Sensitivity Analysis Bayesian Networks
#####################################################################################
rm(list = ls())
library(transformeR)
library(magrittr)
library(bnlearn)
load("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim/tas_interim_10d.rda")
source("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/R/Functions/BasicNetworkFunctions.R")
source("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/R/Functions/propagationFunctions.R")
#permutations
load("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/Struct_learn/datapermutations.rda")
load("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/Struct_learn/permutations.rda")
####################################################################################
# load HC interim iteration data permutation 1 and make list
####################################################################################
for(j in c(1)){
pattern <- paste0("int_hc1_")
hc_interim_list <- list.files("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_struct/hciterations/perm1", full.names = T, pattern = pattern)
hc_interim_names <- list.files("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_struct/hciterations/perm1", pattern = pattern)
hc_interim_names <- gsub(".rda", "", hc_interim_names)
hc_interim_networks <- list()
for (i in 1:length(hc_interim_list)){
object <- get(load(hc_interim_list[i]))
hc_interim_networks[[i]] <- object
}
}
names(hc_interim_networks) <- hc_interim_names
interimsizes <- sapply(hc_interim_networks,narcs)
hc_interims <- hc_interim_networks[order(interimsizes)]
nedges_int_hc <- sapply(hc_interims, narcs)
####################################################################################
# hc interim iteration analyse
####################################################################################3
data_int_RMS <- as.data.frame(TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
hc_interim_fits <- lapply(hc_interims, bn.fit, data = data_int_RMS)
x <- seq(0,9000,100)
y <- seq(100,9100,100)
####################################################################################
# Propagation V81
####################################################################################
#################################################################################
# Single evidence. V81 postive (+ +)
#################################################################################
sizes <- c(18,10,26,length(hc_interims)-1)
sizes
sizes <- c(1)
for (i in sizes){
assign(paste0("prop_int_hc_",x[i],"_",y[i],"i_V81_equal2"),
PropagationExactGeneralPerm(baysnet = hc_interim_fits[[i]],
nodesEvents = 1:648,
valueEvent = ">= 1",
nodesEvidence = c(81),
valueEvidence = c(2),
perm = permutations[[1]]))
save(list = paste0("prop_int_hc_",x[i],"_",y[i],"i_V81_equal2"),
file = paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_propagation/hc_iteration/posV81pos/prop_int_hc_",x[i],"_",y[i],"i_V81_equal2.rda"))
}
save(list = paste0("prop_int_hc_",x[i],"_",y[i],"i_V81_equal2"),
file = paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_propagation/hc_iteration/posV81pos/prop_int_hc_",x[i],"_",y[i],"i_V81_equal2.rda"))
sizes <- c(1)
for (i in sizes){
assign(paste0("propneg_int_hc_",x[i],"_",y[i],"i_V81_equal2"),
PropagationExactGeneralPerm(baysnet = hc_interim_fits[[i]],
nodesEvents = 1:648,
valueEvent = "<= -1",
nodesEvidence = c(81),
valueEvidence = c(2),
perm = permutations[[1]]))
save(list = paste0("propneg_int_hc_",x[i],"_",y[i],"i_V81_equal2"),
file = paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/propagation/hc_iteration/posV81neg/propneg_int_hc_",x[i],"_",y[i],"i_V81_equal2.rda"))
}
save(list = paste0("propneg_int_hc_",x[i],"_",y[i],"i_V81_equal2"),
file = paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_propagation/hc_iteration/posV81neg/propneg_int_hc_",x[i],"_",y[i],"i_V81_equal2.rda"))
save(list = paste0("propneg_int_hc_",x[i],"_",y[i],"i_V81_equal2"),
file = paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_propagation/hc_iteration/posV81neg/propneg_int_hc_",x[i],"_",y[i],"i_V81_equal2.rda"))
sizes <z-c(1)
sizes <- c(1)
for (i in sizes){
assign(paste0("prop_int_hc_",x[i],"_",y[i],"i_V81_equalmin2"),
PropagationExactGeneralPerm(baysnet = hc_interim_fits[[i]],
nodesEvents = 1:648,
valueEvent = ">= 1",
nodesEvidence = c(81),
valueEvidence = c(-2),
perm = permutations[[1]]))
save(list = paste0("prop_int_hc_",x[i],"_",y[i],"i_V81_equalmin2"),
file = paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_propagation/hc_iteration/minV81pos/prop_int_hc_",x[i],"_",y[i],"i_V81_equalmin2.rda"))
}
sizes <- c(1)
for (i in sizes){
assign(paste0("propneg_int_hc_",x[i],"_",y[i],"i_V81_equalmin2"),
PropagationExactGeneralPerm(baysnet = hcfits[[i]],
nodesEvents = 1:648,
valueEvent = "<= -1",
nodesEvidence = c(81),
valueEvidence = c(-2),
perm = permutations[[1]]))
save(list = paste0("propneg_int_hc_",x[i],"_",y[i],"i_V81_equalmin2"),
file = paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_propagation/hc_iteration/minV81neg/propneg_int_hc_",x[i],"_",y[i],"i_V81_equalmin2.rda"))
}
for (i in sizes){
assign(paste0("propneg_int_hc_",x[i],"_",y[i],"i_V81_equalmin2"),
PropagationExactGeneralPerm(baysnet = hc_interim_fits[[i]],
nodesEvents = 1:648,
valueEvent = "<= -1",
nodesEvidence = c(81),
valueEvidence = c(-2),
perm = permutations[[1]]))
save(list = paste0("propneg_int_hc_",x[i],"_",y[i],"i_V81_equalmin2"),
file = paste0("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_propagation/hc_iteration/minV81neg/propneg_int_hc_",x[i],"_",y[i],"i_V81_equalmin2.rda"))
}
############################################################################################
# Creation of Correlation weighted Correlation networks (distance /weights / largeweights)
############################################################################################
rm(list = ls())
source("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/R/Functions/BasicNetworkFunctions.R")
source("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/R/Functions/CN_ConstructionandMeasuresFunctions.R")
source("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/R/Functions/propagationFunctions.R")
load("/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim/tas_interim_10d.rda")
tau <- seq(0.00,0.99,0.01)
gridGraphs_int_CN <- lapply(tau,graph_from_Grid, grid = tas_ncep_10d)
gridGraphs_int_CN <- lapply(tau,graph_from_Grid, grid = tas_interim_10d)
gridGraphs_int_CN <- lapply(tau,graph_from_Grid, grid = tas_interim_10d, method = "spearman")
# save(gridGraphs, file = "/Volumes/ubuntu/Trabajo/R_practice/Data/gridGraphs.rda")
Graphs_int_CN <- lapply(gridGraphs_int_CN, function(x){x$graph})
nedges_int_CN <- lapply(Graphs_int_CN , E)
nedges_int_CN <- sapply(nedges_int_CN, length)
names(Graphs_int_CN) <- as.character(nedges_int_CN)
# save(gridGraphs, file = "/Volumes/ubuntu/Trabajo/R_practice/Data/gridGraphs.rda")
graphs_int_CN <- lapply(gridGraphs_int_CN, function(x){x$graph})
nedges_int_CN <- lapply(graphs_int_CN , E)
nedges_int_CN <- sapply(nedges_int_CN, length)
names(Graphs_int_CN) <- as.character(nedges_int_CN)
names(graphs_int_CN) <- as.character(nedges_int_CN)
graphs_int_CN[[100]]
str_vs_dis_2(graphs_int_CN[[100]],perm = NULL, data.dag = TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
test <- str_vs_dis_2(graphs_int_CN[[100]],perm = NULL, data.dag = TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
test
testvervolg <- igraph.weights(test,type = "cn", perm = NULL,data.dag = TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
testvervolg <- igraph.weights(test,type = "cn", perm = NULL, fromdist = 0)
testvervolg
E(testvervolg)$largeweights
E(testvervolg)$weights
test2 <- cn.strengths(graphs_int_CN[[100]],data.igraph =TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
test2dist <- igraph.distances(test2, data.igraph = TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
all.equal(test,test2dist)
test2
test2dist
test
all.equal(test,test2dist)
test2dist <- igraph.distances(graphs_int_CN[[100]], data.igraph = TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
test2 <- cn.strengths(test2dist,data.igraph = TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
all.equal(test,test2)
test2
test
E(test2)$strenghts
E(test)$strengths
all.equal(E(test2)$strenghts,E(test)$strengths)
which(E(test2)$strenghts ==E(test)$strengths)
dag <- graphs_int_CN[[100]]
# criterion <- NULL
# k <- NULL
data.igraph<- TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE)
# perm <- permutations[[1]]
require(data.table)
names <- c()
names
for(i in 1:648) names <- append(names,paste0("V",i))
V(igraph)$name <- names
nodenames <- V(igraph)$name
igraph <- graphs_int_CN[[100]]
names <- c()
names
for(i in 1:648) names <- append(names,paste0("V",i))
V(igraph)$name <- names
nodenames <- V(igraph)$name
igraph <- graphs_int_CN[[100]]
igraph
# criterion <- NULL
# k <- NULL
data.igraph<- TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE)
# perm <- permutations[[1]]
require(data.table)
names <- c()
names
for(i in 1:648) names <- append(names,paste0("V",i))
V(igraph)$name <- names
nodenames <- V(igraph)$name
igraph
# Make edgelist in igraph class by edgeindices adjacancy matrix
# for selecting edgeindices when applying Haversine
adjmat <- as.matrix(as_adjacency_matrix(igraph))
adjmat
# Make edgelist in igraph class by edgeindices adjacancy matrix
# for selecting edgeindices when applying Haversine
adjmat <- as.matrix(as_adjacency_matrix(igraph))
adjmattri <- adjmat
adjmattri[lower.tri(adjmattri)] <- 0
cormatrix <- abs(cor(data.igraph))
cormatrix
rownames(cormatrix) <- colnames(cormatrix) <-  names
cormatrix[lower.tri(cormatrix)] <- 0
edgeindices <- which(adjmattri == 1, arr.ind = TRUE)
noedgeindices <-  which(adjmattri == 0, arr.ind = TRUE)
cormatrix[noedgeindices] <- 0
edgeindices2 <- which(cormatrix != 0, arr.ind = TRUE)
all.equal(edgeindices, edgeindices2)
fromV <- nodenames[edgeindices[,1]]
toV <- nodenames[edgeindices[,2]]
fromtoV <- cbind(fromV,toV)
edgeindices[1,]
cormatrix[edgeindices[,]]
# identify which indices in igraph edgelist correspond to indices in adjmatrix
# in order to add edgeattributes to igraph
indsame <- c()
nrow(as_edgelist(igraph))
i <- 1
fromtoV[1,]
as_edgelist(igraph)[59,]
for (i in 1:nrow(fromtoV)){
int <- intersect(which(fromtoV[i,1] == as_edgelist(igraph)[,1] ),
which(fromtoV[i,2] == as_edgelist(igraph)[,2] ))
indsame[i] <- int
}
strengths <- cormatrix[edgeindices]
strengths
strengthsedgelist <- strengths[indsame]
strengthsedgelist
igraph <- graphs_int_CN[[100]]
# criterion <- NULL
# k <- NULL
data.igraph<- TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE)
# perm <- permutations[[1]]
require(data.table)
names <- c()
names
for(i in 1:648) names <- append(names,paste0("V",i))
V(igraph)$name <- names
nodenames <- V(igraph)$name
# Make edgelist in igraph class by edgeindices adjacancy matrix
# for selecting edgeindices when applying Haversine
adjmat <- as.matrix(as_adjacency_matrix(igraph))
adjmattri <- adjmat
adjmattri[lower.tri(adjmattri)] <- 0
cormatrix <- abs(cor(data.igraph))
cormatrix
rownames(cormatrix) <- colnames(cormatrix) <-  names
cormatrix[lower.tri(cormatrix)] <- 0
edgeindices <- which(adjmattri == 1, arr.ind = TRUE)
edgeindices
E(igraph)
as_edgelist(igraph)
cormatrix[edgeindices[,]]
fromtoV
fromtoV[edgeindices]
cormatrix[edgeindices[,]]
fromtoV[indsame]
fromtoV[indsame,]
fromtoV[,indsame]
fromtoV[indsame]
fromtoV[indsame,]
fromtoV
as_edgelist(igraph)[indsame]
as_edgelist(igraph)[indsame,]
fromtoV[indsame,]
as_edgelist(igraph)
fromtoV[indsame,]
cormatrix[edgeindices[,]]
cormatrix[edgeindices]
fromtoV[1,]
as_edgelist(igraph)[indsame,]
as_edgelist(igraph)[,1]
as_edgelist(igraph)[,2]
fromtoV[i,1]
i <- 1
fromtoV[i,1]
fromtoV[,1]
i <- 4
int <- intersect(which(fromtoV[i,1] == as_edgelist(igraph)[,1] ),
which(fromtoV[i,2] == as_edgelist(igraph)[,2] ))
int
fromtoV[4,]
fromtoV
i <- 3
int <- intersect(which(fromtoV[i,1] == as_edgelist(igraph)[,1] ),
which(fromtoV[i,2] == as_edgelist(igraph)[,2] ))
int
as_edgelist(igraph)[7,]
indsame
as_edgelist(igraph)[indsame,]
fromtoV
all.equal(fromtoV,as_edgelist(igraph)[indsame,])
attributes(fromtoV)
attributes(as_edgelist(igraph)[indsame,])
all.equal(fromtoV,as_edgelist(igraph)[indsame,], check.attributes = FALSE)
igraph <- graphs_int_CN[[100]]
# criterion <- NULL
# k <- NULL
data.igraph<- TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE)
# perm <- permutations[[1]]
require(data.table)
names <- c()
names
for(i in 1:648) names <- append(names,paste0("V",i))
V(igraph)$name <- names
nodenames <- V(igraph)$name
# Make edgelist in igraph class by edgeindices adjacancy matrix
# for selecting edgeindices when applying Haversine
adjmat <- as.matrix(as_adjacency_matrix(igraph))
adjmattri <- adjmat
adjmattri[lower.tri(adjmattri)] <- 0
cormatrix <- abs(cor(data.igraph))
cormatrix
rownames(cormatrix) <- colnames(cormatrix) <-  names
cormatrix[lower.tri(cormatrix)] <- 0
edgeindices <- which(adjmattri == 1, arr.ind = TRUE)
noedgeindices <-  which(adjmattri == 0, arr.ind = TRUE)
cormatrix[noedgeindices] <- 0
edgeindices2 <- which(cormatrix != 0, arr.ind = TRUE)
all.equal(edgeindices, edgeindices2)
fromV <- nodenames[edgeindices[,1]]
toV <- nodenames[edgeindices[,2]]
fromtoV <- cbind(fromV,toV)
edgeindices[1,]
cormatrix[edgeindices[,]]
# identify which indices in igraph edgelist correspond to indices in adjmatrix
# in order to add edgeattributes to igraph
indsame <- c()
nrow(as_edgelist(igraph))
i <- 3
fromtoV[4,]
fromtoV[3,]
for (i in 1:nrow(fromtoV)){
int <- intersect(which(as_edgelist[i,1] == fromtoV(igraph)[,1] ),
which(as_edgelist[i,2] == fromtoV(igraph)[,2] ))
indsame[i] <- int
}
for (i in 1:nrow(fromtoV)){
int <- intersect(which(as_edgelist(igraph)[i,1] == fromtoV[,1] ),
which(as_edgelist(igraph)[i,2] == fromtoV[,2] ))
indsame[i] <- int
}
fromtoV[indsame,]
all.equal(fromtoV[indsame,],as_edgelist(igraph), check.attributes = FALSE)
strengths <- cormatrix[edgeindices]
strengths
strengthsedgelist <- strengths[indsame]
E(igraph)$strenghts <- strengthsedgelist
test2 <- cn.strengths_2(test2dist,data.igraph = TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
cn.strengths_2 <- function(igraph, data.igraph, k = NULL, criterion = NULL, perm = NULL){
# igraph <- graphs_int_CN[[100]]
# criterion <- NULL
# k <- NULL
# data.igraph<- TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE)
# perm <- permutations[[1]]
require(data.table)
# Check if class is igraph or bn, add characteristics for plotting purpose
names <- c()
names
for(i in 1:648) names <- append(names,paste0("V",i))
V(igraph)$name <- names
nodenames <- V(igraph)$name
# Make edgelist in igraph class by edgeindices adjacancy matrix
# for selecting edgeindices when applying Haversine
adjmat <- as.matrix(as_adjacency_matrix(igraph))
adjmattri <- adjmat
adjmattri[lower.tri(adjmattri)] <- 0
cormatrix <- abs(cor(data.igraph))
cormatrix
rownames(cormatrix) <- colnames(cormatrix) <-  names
cormatrix[lower.tri(cormatrix)] <- 0
edgeindices <- which(adjmattri == 1, arr.ind = TRUE)
noedgeindices <-  which(adjmattri == 0, arr.ind = TRUE)
cormatrix[noedgeindices] <- 0
edgeindices2 <- which(cormatrix != 0, arr.ind = TRUE)
all.equal(edgeindices, edgeindices2)
fromV <- nodenames[edgeindices[,1]]
toV <- nodenames[edgeindices[,2]]
fromtoV <- cbind(fromV,toV)
edgeindices[1,]
cormatrix[edgeindices[,]]
# identify which indices in igraph edgelist correspond to indices in adjmatrix
# in order to add edgeattributes to igraph
indsame <- c()
nrow(as_edgelist(igraph))
i <- 3
fromtoV[3,]
as_edgelist(igraph)[7,]
for (i in 1:nrow(fromtoV)){
int <- intersect(which(as_edgelist(igraph)[i,1] == fromtoV[,1] ),
which(as_edgelist(igraph)[i,2] == fromtoV[,2] ))
indsame[i] <- int
}
fromtoV[indsame,]
all.equal(fromtoV[indsame,],as_edgelist(igraph), check.attributes = FALSE)
strengths <- cormatrix[edgeindices]
strengths
strengthsedgelist <- strengths[indsame]
# i <- 1
# fromtoV[59,]
# as_edgelist(igraph)[1,]
# newstrengths <- numeric(nrow(as_edgelist(igraph)))
# for (i in 1:nrow(as_edgelist(igraph))){
#   ind <- indsame[i]
#   as_edgelist(igraph)[ind,]
#   newstrengths[i] <- strengths[ind]
# }
E(igraph)$strenghts <- strengthsedgelist
return(igraph)
}
test2 <- cn.strengths_2(test2dist,data.igraph = TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
all.equal(E(test2)$strenghts,E(test)$strengths)
tau <- c(0.99)
gridGraphs_int_CN <- lapply(tau,graph_from_Grid, grid = tas_interim_10d, method = "spearman")
# save(gridGraphs, file = "/Volumes/ubuntu/Trabajo/R_practice/Data/gridGraphs.rda")
graphs_int_CN <- lapply(gridGraphs_int_CN, function(x){x$graph})
nedges_int_CN <- lapply(graphs_int_CN , E)
nedges_int_CN <- sapply(nedges_int_CN, length)
names(graphs_int_CN) <- as.character(nedges_int_CN)
graphs_int_CN_str_dist <- lapply(graphs_int_CN, str_vs_dis_2, perm = NULL, data.dag = TimeCoordsAnom_from_Grid_rms(tas_interim_10d, rms = TRUE))
save(graphs_int_CN_str_dist, file = "/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_struct_edgeattributes/perm1/graphs_int_CN_str_dist.rda")
save(graphs_int_CN_str_dist, file = "/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_struct_edgeattributes/perm1/graphs_int_CN_str_dist.rda")
graphs_int_CN_wei_dist <- lapply(graphs_int_CN_str_dist, igraph.weights, type = "cn", fromdist = 0, perm = NULL)
save(graphs_int_CN_wei_dist, file = "/oceano/gmeteo/WORK/lisette/Trabajo/R_practice/Data/interim_struct_edgeattributes/perm1/graphs_int_CN_wei_dist.rda")
